---    
  - name: Create the mongod user
    user: name=mongod comment="MongoD"

  - name: Add public key
    apt_key: keyserver=keyserver.ubuntu.com id=7F0CEB10

  - name: Add Repository
    apt_repository: repo='deb http://repo.mongodb.org/apt/ubuntu/ trusty/mongodb-org/3.0 multiverse' state=present
    when: ansible_os_family == 'Debian'

  - name: Install the mongodb package
    apt: name={{ item }} state=present
    with_items:
    - mongodb-org
    when: ansible_os_family == 'Debian'

  - name: RedHat | Add source sources
    template: src=mongodb.repo.j2 dest=/etc/yum.repos.d/mongodb.repo
    when: ansible_os_family == 'RedHat'

  - name: RedHat | Install Packages
    yum: name={{ item }} state=installed
    with_items: mongodb_packages
    when: ansible_os_family == 'RedHat'

  - name: create data directory for mongodb
    file: path={{ mongodb_datadir_prefix }}/portal state=directory owner=mongod group=mongod

  - name: Create the mongodb configuration file
    template: src=mongodb.conf dest=/etc/init/mongodb.conf

  - name: Copy the keyfile for authentication
    copy: src=secret dest={{ mongodb_datadir_prefix }}/secret owner=mongod group=mongod mode=0400

  - name: Start Mongo Service
    service: name=mongodb state=started
